public class Cart
{
    private readonly IWarehouse _warehouse;
    private readonly Dictionary<Good, int> _goods = new Dictionary<Good, int>();

    public Cart(IWarehouse warehouse)
    {
        _warehouse = warehouse;
    }

    public bool IsOrdered { get; private set; }

    public void Add(Good good, int quantity)
    {
        if (IsOrdered)
            throw new InvalidOperationException("Заказ уже оформлен!!!");

        int current = _goods.GetValueOrDefault(good, 0);
        int available = _warehouse.GetQuantity(good);

        if (current + quantity > available)
            throw new InvalidOperationException($"Недостаточно {good.Name} на складе.");

        _goods[good] = current + quantity;
    }

    public Order Order()
    {
        if (IsOrdered)
            throw new InvalidOperationException("Заказ уже оформлен!!!");

        foreach (var (good, quantity) in _goods)
            _warehouse.Remove(good, quantity);

        IsOrdered = true;
        return new Order();
    }
}
